# stoporcsmedia
![logo-proto](https://user-images.githubusercontent.com/94710002/188512401-72198c78-1e53-4a8e-ab63-44a3510fac32.png)
SOM - пакет, який обробляє посилання на ворожі ресурси та генерує текст для скарг у вигляді повідомлень або отримувача, теми та тексту листа до підтримки платформи.
***
#### Працює з посиланнями на контент наступних платформ:
- Telegram (посилання вигляду `t.me/example` - різні; `t.me/s/example` - канали);
- TikTok (посилання вигляду `vm.tiktok.com/example`, `tiktok.com/example` - відео; `tiktok.com/@example` - аккаунти);
- Twitter (посилання вигляду `twitter.com/example`, `t.co/example` - (тільки аккаунти));
- YouTube (посилання вигляду `youtube.com/example` - аккаунти; `youtube.com/watch?v=example` - відео);
- Instagram (посилання вигляду `instagram.com/example` - аккаунти)
- Facebook (посилання вигляду `facebook.com/example`, `fb.com/example` - аккаунти; `facebook.com/example/posts/example` - публікація, `fb.watch/example` - відео)
---
#### Для генерації унікальних текстів використовується:
- Гнучка база частин тексту з можливістю редагування;
- SpamAntiDetect алгоритм з заміною символів;
- Результат випадковий на двох мовах: українська та англійська.
---
#### Недоліки
- Необхідність допрацювання бази частин тексту (вирішується);
- Можливі неточності та помилки в українському варіанті через машинний переклад з англійскої (вирішується, якщо написати базу українською).
- Можлива невелика швидкість роботи та помилки (прошу відкривати тікет у [Issues](https://github.com/NightlyShelf/stoporcsmedia/issues/new) при знаходженні помилки або багу)
---
## Встановлення
- Завантажте файл xxx.whl;
- Завантажте файл requirements.txt
- Виконайте команду pip install xxx.whl -r requirements.txt
- Протестуйте!
- Компілятор можете завантажити окремо, або зібрати власноруч за допомогою pyinstaller.
## Використання

Модуль поділяється на підготовчу (Compiler) та робочу (API) частину.
### Compiler

Підготовча частина, або компілятор - консольна програма (або за вашим бажанням об'єкт, з яким ви можете працювати у коді,
для підготовки та тестування файлу з об'єктами Task. Task - об'єкти, з якими працює робочий модуль. За допомогою компілятора ви
вручну або автоматично (завантаживши файл з посиланнями на ресурси) отримаєте файл з об'єктами Task. Якщо ж ви зробили помилку у записі
в цьому файлі, ви можете просто видалити рядок з помилковим записом та записати правильний у файл.

#### Консольний варіант

Синтаксис: `compiler.exe -mode=MODE -wmode=WMODE -datain=INPUTDATA -dataout=OUTPUTDATA`

`MODE` - є три режими роботи: `auto`, `manual` та `testing`

`auto` - автоматичний режим. Вам необхідно вибрати вхідний файл з посиланнями та вихідний файл.
- `INPUTDATA` - шлях до файлу з посиланнями у вигляді абсолютного (`C:/test/test.txt`) або відносного (`test.txt`) шляху. Кожне посилання має бути з нового рядка.
- `OUTPUTDATA` - шлях до вихідного файлу у вигляді абсолютного (`C:/test/test.txt`) або відносного (`test.txt`) шляху.

`manual` - ручний режим. 
- У `INPUTDATA` вам необхідно вказати характеристику об'єкта у наступному вигляді:
`rt=TYPE[f=ACTYPE[n=NETWORK[c=CRIMES[lnk=LINK[exl=EXLINKS`, де:


- `TYPE`: `email` для створення листа; `message` для звичайної скарги;
- `ACTYPE`: `chnl` - канал (у YouTube або Telegram); `vdio` - відео (YouTube, TikTok); `acnt` - аккаунт (будь-яка соцмережа);
`twet` - твіт у Twitter; `publ` - будь-яке повідомлення, публікація та інше. Якщо
маєте сумніви щодо типу повідомлення і це не аккаунт, вибирайте цей варіант.
- `NETWORK`: соц. мережа. Варіанти: `twtr` - Twitter; `ytub` - Youtube; `inst` - Instagram; `tlgm` - Telegram; `tktk` - TikTok; `fcbk` - Facebook.
- `CRIMES`: порушення правил платформи/етичних норм. Треба вказувати через кому у вигляді `с=example,example,example`. На даний момент список порушень наступний: 
`mup` - фото/відео вбитих людей; `aup` - антиукраїнська пропаганда; `hsp` - образливі та/або агресивні висловлювання; `msc` - фото/відео обстрілів у цілях пропаганди; `pwr` - пропаганда війни; `pkp` - пропаганда вбивства людей; `iui` - призиви/інформація, яка порушує територіальну цілісність України; `ofs` - неетичні висловлювання/призиви; `dfk` - розповсюдження фейків/несправжньої інформації; `dpd` - розповсюдження особистих даних та/або інформації.
>Візміть до уваги те, що потрібно вказати **мінімум** 4 порушення для найкращої ефективності!

- `LINK`: посилання на ресурс, сторінку або публікацію.
> ЗВЕРНІТЬ УВАГУ! Вам потрібно замінити символ **&** на символ **%26** у посиланні у разі його наявності!
- `EXLINKS`: необов'язкова частина. Якщо ресурс є каналом або акаунтом, ви можете вказати тут
додаткові посилання на публікації з порушеннями. Наприклад, у випадку YouTube каналу ви можете вказати відео з порушеннями.
Синтаксис: `exl=CRIME#LINK~CRIME#LINK~CRIME#LINK`, де:
`CRIME` - порушення у публікації. Вибрати ви можете тільки **одне** порушення. Їх список та ключі аналогічні з описаними у `CRIMES`.
`LINK` - посилання на публікацію. 
> ЗВЕРНІТЬ УВАГУ! Вам потрібно замінити символ `&` на символи `%26` у посиланнях у разі його наявності!

`testing` - спеціальний режим, який можна використовувати для перевірки отриманих об'єктів. 
- У `INPUTDATA` вкажіть шлях до файлу з об'єктами у вигляді абсолютного (`C:/test/test.txt`) або відносного (`test.txt`) шляху.
- У `OUTPUTDATA` вкажіть шлях до вихідного файлу у вигляді абсолютного (`C:/test/test.txt`) або відносного (`test.txt`) шляху.
Туди буде згенерована доповідь.

`WMODE` - режим запису у файл. `rwrite` - перезаписати файл, `add` - дозаписати; у випадку якщо файл не існує, в обох випадках створиться новий.
Цей аргумент треба вказувати **ОБОВ'ЯЗКОВО**, в незалежності від обраного режиму.

Приклад:
- `compiler.exe -mode=manual -wmode=rewrite -datain=rt=email[f=acnt[n=twtr[c=iui,dfk,hsp, iui[lnk=https:/twitter.com/gazetaru[exl=iui#https://twitter.com/GazetaRu/status/1534849682576445440?s=20%26t=1ZyTeGS74miMYloG6kep7g~dfk#https://twitter.com/GazetaRu/status/1534842132388892674?s=20%26t=NAKVMpiBdSNDlzlUi1v4NQ-dataout=test.pcl`
- `compiler.exe -mode=auto -wmode=add -datain=test.txt -dataout=result.txt`
- `compiler.exe -mode=testing -wmode=rewrite -datain=test.txt -dataout=result.txt`
---
### Використання з коду

Спочатку, імпортуйте модуль та створіть об'єкт Compiler:
```python
from som.compiler import * 
compiler = Compiler()
 ```

Далі, вам доступні наступні функції:
- `compiler.GenerateManual(keys)` - повертає об'єкт Task за вказаними характеристиками. Keys - рядок із ключами, аналогічними datain у manual режимі консольного варіанту. Наприклад: `compiler.GenerateManual("rt=email[f=acnt[n=twtr[c=iui,dfk,hsp, iui[lnk=https:/twitter.com/gazetaru[exl=iui#https://twitter.com/GazetaRu/status/1534849682576445440?s=20%26t=1ZyTeGS74miMYloG6kep7g~dfk#https://twitter.com/GazetaRu/status/1534842132388892674?s=20%26t=NAKVMpiBdSNDlzlUi1v4NQ-dataout=test.pcl")`
---
- `compiler.GenerateAuto(link)` - повертає об'єкт Task з автоматично згенерованими характеристиками. link - посилання на ресурс у вигляді рядка. 
--- 
- `compiler.Test(object)` - повертає детальну характеристику зашифрованого об'єкта. Наприклад, ви можете копіювати байти одного рядка у згенерованому файлі та отримати характеристику об'єкта.
---

### API
Ця частина є основною, і за її допомогою можна генерувати повідомлення. Для початку, імпортуйте модуль та створіть об'єкт API:
```python
from som.api import *
api = API("NICK", debug=False)
```
Вкажіть нік користувача (бажано ім'я та прізвище, воно буде використовуватися для підпису листів). Також можете вказати `debug=True` для отримання детальних даних про виконання у процесі розробки.

>Візміть до уваги, що API працює тільки з об'єктами, у яких VERSION дорівнює API.ACTUALVERSION!
#### Ініціалізація робочих файлів
Далі, вам потрібно встановити робочі файли. Є два варіанти: 
```python
#Спосіб 1: Завантажити з файлів. Вам необхідно вказати шлях до робочих файлів у вигляді абсолютного або відносного шляху. Про їх підготовку ви можете дізнатись у відповідній частині.
api.SetSourcesFromFile("path_to_email/file.csv", "path_to_message/file.csv")

#Cпосіб 2: У випадку якщо в вас є необхідні дані у вигляді масиву з масивами даних, де кожен вкладений масив є рядком таблиці. Порядок аргументів той самий, що й у першому способі.
api.SetSourcesText([["EXAMPLE", "EXAMPLE2", "EXAMPLE3", "EXAMPLE4"],["EXAMPLE5", "EXAMPLE6", "EXAMPLE7", "EXAMPLE8"]], [["EXAMPLE", "EXAMPLE2", "EXAMPLE3", "EXAMPLE4"],["EXAMPLE5", "EXAMPLE6", "EXAMPLE7", "EXAMPLE8"]])
```
#### Ініцалізація ресурсів для скарг
Наступним кроком буде завантаження ресурсів для скарг. Ви можете використати файли, отримані за допомогою Compiler, або визначити ресурси вручну використовуючи som.compiler.
```python
#Завантажити об'єкти з файлу. path_to_file шлях - до файлу у вигляді абсолютного або відносного шляху.
api.LoadObjectsFromFile("path_to_file")
#Завантажити об'єкти з байт, які записані до файлу який згенерований Complier.
api.LoadObjectsFromBytes(b'example')
#Завантажити об'єкти з массиву байт.
api.LoadObjectsFromBytesArray([b'example', b'example'])
```
>Зверніть увагу, що при завантаженні з байтів, кожний ресурс має бути розділений за допомогою `\n`!

Усі отримані об'єкти зберігаються у змінній `api.objects`.
Ви можете додавати туди ресурси вручну, або за допомогою методів:
```python
api.AddObject(object)
#Або:
api.AddObjectManual(COMPLAINT_TYPE, RESOURCE_TYPE, CRIMES, NETWORK, LINK, EXLINKS)
```
#### Режим повтору
Наступним кроком буде встановлення режиму повтору:
```python
api.RepeatingMode(allowRepeating=True) #Дозволить повторюватися ресурсам по колу.
#Якщо False, ресурси будуть видалятися із списку api.objects та не будуть більше використовуватися.
```
#### Генерація
Отже, тепер можна генерувати повідомлення:
```python
api.GetRandomTask() #Повертає випадковий об'єкт із api.objects.
api.GenerateUsingObject(object) #Генерує повідомлення(або лист) за вказаним ресурсом object.
api.GenerateRandom() #Генерує повідомлення(або лист) за випадково вибраним ресурсом з api.object.
```
>Методи генерації повертають або рядок тексту(у випадку простої скарги у вигляді повідомлення), або список з елементами, де перший (0-ий) - отримувач (у вигляді рядка тексту), другий (1-ий) - заголовок листа (у вигляді рядку тексту), та третій (2-ий) - це текст для листа.

#### Інше
Змінити нік можна за допомогою:
```python
api.SetNick("Новий нік")
```
### Робочі файли
Алгоритм не генерує самостійно текст, а використовує частини та створює унікального тексту. 
Для роботи потрібні два файли з частинками тексту: для повідомлень(текстових скарг) та для листів до підтримки платформи.
Розглянемо принцип створення цих файлів. В обох випадках вам необхідно використовувати csv-таблиці з діалектом "excel".
#### Email
Створіть csv-файл з діалектом excel.
Далі, ми будемо використовувати чотири стовпчики:
- Перший - соцмережа. Вказати `Instagram`, `Facebook`, `TikTok`, `Telegram`, `Twitter`, `Youtube` або `Any`.
- Другий - порушення. Вказати `Any` або порушення у розгорнутому вигляді.
- Третій - контент.
- Четвертий - ключ.

Є два рівні організації ключів - скелет та контекстні.
Скелет-ключі - логічні одиниці, за допомогою яких формується повідомлення. Вони, на відміну від контекстних, містять у своєму контенті тільки інші ключі.
Контекстні ключі - частини речень.

Спочатку генерується скелет з глобальних ключів. Його варіанти записуються за допомогою ключа `TXT`.
Глобальні ключі:
- `GRRR` - привітальна частина.
- `APPP` - перший абзац, з поясненнями причин листа та проханням
- `RSSS` - другий абзац, список підресурсів(відео, публікацій у випадку каналу) з порушеннями (якщо є)
- `GBBB` - третій абзац, список порушень ресурсу
- `BLLL` - заклик до блокування
- `ENDD` - кінець листу, підпис

Розділяти їх потрібно за допомогою `*dn*`.
Приклад: `GRRR*dn*APPP*dn*RSSS*dn*BLLL*dn*ENDD`

Кожен з глобальних ключів можна описати детальніше, за допомогою контекстних ключів.

 `GRRR`:
- `GREET` - привітання
- Приклад: `GREET`

 `APPP`:
- `PREV` - фон історії, події які привели до написання скарги. Наприклад: `I have been surfing the net and I saw that {TYPE} with forbidden content: {ALINK}.`
- `FACT` - факт порушення. Наприклад: `The following content of that {TYPE} ({ALINK}) is not allowed by rules.` 
- `EXPL` - факт-причина порушення. Наприклад: `That {TYPE} publishes hardcore video about deaths, poses a threat to life of Ukrainian civilians, sharing false information and russian propaganda, calls to murdering of innocent people, sharing terroristic and nazi expressions, making corrections to the shelling. etc.`
- `DEMD` - прохання заблокувати. Наприклад: `I am asking you to check and block following account, in particular for violation of rules.`
- Приклад: `PREV*n*FACT*n*EXPL*n*DEMD`
 
 `RSSS`:
- `RSIN` - речення "ось докази контенту з порушеннями". Наприклад: `Here is some examples of content with violations:`
- RES1-4 - приклади контенту. Їм не потрібно надавати значень вручну!
- Приклад: `RSIN*n*RES2*n*RES3*n*RES4*n*RES1`
 
 `GBBB`:    
- `GBIN` - речення "Я зафіксував наступні порушення:". Наприклад: `I found next violations:`
- `VR` - порушення. Цей ключ є особливим, так, як у рядку із ним у другому стовпчику вам необхідно ОБОВ'ЯЗКОВО вказати порушення. При його записі використовуйте ключ `VR`, а при записі у глобальних ключах - `VR1-5`. Наприклад: (2 стовпчик)`propaganda of the war` (3 стовпчик) `- propaganda of war  (Article 436 of the Criminal Code of Ukraine)`
- Приклад: `GBIN*n*VR4*n*VR1*n*VR2*n*VR4`
 
 `BLLL`:
- `PREN` - синоніми до виразу "В кінці; Підбиваючи підсумки" з комою в кінці. Наприклад: `In connection with above,`
- `RQOF` - синоніми до виразу "На законних підставах, по закону" з комою в кінці. `Наприклад: under international law and laws of Ukraine country,`
- `FDEM` - прохання заблокувати/перевірити ресурс. Наприклад: `Please check and block this content as soon as possible!`
- Приклад: `PREN RQOF FDEM`
- Зверніть увагу, що ця частина розділяється не `*n*`, а пропусками!
 
 `ENDD`:
 - `LSWD` - фінальне прохання заблокувати якнайшвидше. Наприклад: `Please, check my complaint as soon as possible.`
 - `SIGN` - підпис. Використайте маркер `{NICK}`. Наприклад: `Yours faithfully, {NICK}.`
 - Приклад: `LSWD*dn*SIGN`

Ви можете також використовувати наступні маркери, які згодом заміняться на потрібну інформацію:
 - `{NTWRK}` - заміниться назвою соцмережі
 - `{TYPE}` заміниться типом ресурсу(аккаунт, канал та т.п)
 - `{ALINK}` заміниться посиланням на ресурс(основним)
 - `{NICK}` заміниться на нік(підпис) користувача
 - `*dn*` зробить пропуск у один рядок(аналогічно `\n\n`)
 - `*n*` перенесе на наступний рядок(аналогічно `\n`)

`HEADER` - особливий ключ. Він є заголовком листа. Наприклад: `Report about the publication that violates {NTWRK} rules`

Приклад ви знайдете у файлі Email.csv.

#### Message
Створіть csv-файл з діалектом excel.
Далі, ми будемо використовувати чотири стовпчики:
- Перший - ключ. 
- Другий - соцмережа.
- Третій - тип ресурсу.
- Четвертий - контент.

У цьому варіанті тільки чотири види ключів.
 - `TXT` - основний скелет. Наприклад: `INTR*n*MAIN*n*BLCK`
 - `INTR` - вступна частина. Привітання. Наприклад: `Hi {NTWRK} support,`
 - `MAIN` - основна частина. Тут можна використовувати ключі {CTNT1-4}, які буде замінено на порушення. Наприклад: `I'd like to complain about that this channel publish {CTNT1}, {CTNT2}, {CTNT3} and {CTNT4}.`
 - `BLCK` - завершальна частина, прохання заблокувати ресурс. Наприклад: `This report isn't groundless, check  and block the following {TYPE}!`

Ви можете також використовувати наступні маркери, які згодом заміняться на потрібну інформацію:
 - `{NTWRK}` - заміниться назвою соцмережі
 - `{TYPE}` заміниться типом ресурсу(аккаунт, канал та т.п)
 - `{ALINK}` заміниться посиланням на ресурс(основним)
 - `{NICK}` заміниться на нік(підпис) користувача
 - `*dn*` зробить пропуск у один рядок(аналогічно `\n\n`)
 - `*n*` перенесе на наступний рядок(аналогічно `\n`)

Приклад ви знайдете у файлі Message.csv.

## Тести
Файл `example.py` створений для демонстрації роботи API. Для його використання, просто замініть шляхи до файлів на необхідні вам.

## Інші запитання
Ця документація є вичерпною, тому при виникненні питань ви можете звернутися до мене, або проаналізувати код самостійно, виправивши та зібравши як вам потрібно.
